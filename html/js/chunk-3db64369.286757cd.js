(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3db64369","chunk-2e9090a6"],{"4ae6":function(e,t){var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"LabelPrintHistoryCreateInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"createLabelPrintHistory"},arguments:[{kind:"Argument",name:{kind:"Name",value:"data"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"createdAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"updatedAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"labelCode"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:153}};n.loc.source={body:"mutation($data: LabelPrintHistoryCreateInput!) {\r\n  createLabelPrintHistory(data: $data) {\r\n    id\r\n    createdAt\r\n    updatedAt\r\n    labelCode\r\n  }\r\n}\r\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function r(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){r(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){r(e,t)})),e.definitions&&e.definitions.forEach((function(e){r(e,t)}))}var i={};(function(){n.definitions.forEach((function(e){if(e.name){var t=new Set;r(e,t),i[e.name.value]=t}}))})(),e.exports=n},"5c97":function(e,t,n){},7638:function(e,t,n){"use strict";n.d(t,"h",(function(){return r})),n.d(t,"b",(function(){return i})),n.d(t,"g",(function(){return a})),n.d(t,"i",(function(){return o})),n.d(t,"a",(function(){return s})),n.d(t,"f",(function(){return c})),n.d(t,"e",(function(){return l})),n.d(t,"c",(function(){return u})),n.d(t,"d",(function(){return d}));var r="SECTOR_TYPE",i="Inv",a="PRINTER",o={edit:"edit",add:"add"},s={name:100,enterprise:2,site:2,area:4,sector:4,location:6,workCenter:20,workStation:20},c={area:"area",sector:"sector",location:"location"},l={Enterprise:"Enterprise",Site:"Site",Area:"Area",Sector:"Sector",Location:"Location",WorkCenter:"WorkCenter",WorkStation:"WorkStation",Device:"Device",AppCodeRule:"AppCodeRule",CodeInfo:"CodeInfo",UserGroup:"UserGroup",SignatureRule:"SignatureRule",MFGInstruction:"MFGInstruction"},u="XX[YYYY][MM][####]",d="MAX"},"7d9e":function(e,t,n){"use strict";var r=n("5c97"),i=n.n(r);i.a},"8eac":function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("Modal",{ref:"modal",attrs:{closable:!1,"mask-closable":!1,width:e.modalWidth},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[n("p",{attrs:{slot:"header"},slot:"header"},[n("Icon",{attrs:{type:e.icon}}),n("span",[e._v(e._s(e.title))])],1),e._t("default"),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("Button",{attrs:{disabled:e.loading},on:{click:e.cancelEvent}},[e._v("\n      "+e._s(e.canceltext)+"\n    ")]),e.isOk?n("Button",{attrs:{loading:e.loading,type:"primary"},on:{click:e.okEvent}},[e._v(e._s(e.$t("common.buttons.ok")))]):e._e()],1)],2)},i=[],a=(n("c5f6"),{name:"edit-modal",props:{value:{type:Boolean,default:!1},isAdding:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},modalWidth:{type:Number,default:520},subtitle:{type:String,default:""},isOk:{type:Boolean,default:!0},subIcon:{type:String,default:""},subCanceltext:{type:String,default:""}},data:function(){return{icon:this.subIcon||"md-create",title:this.subtitle||this.$t("common.actions.edit"),visible:this.value,editing:!this.isAdding,canceltext:this.subCanceltext||this.$t("common.buttons.cancel")}},methods:{cancelEvent:function(){this.$emit("cancel")},okEvent:function(){this.$emit("ok")},open:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.editing=e,this.icon=!0===e?"md-create":"md-add",this.title=this.subtitle?this.subtitle:!0===e?this.$t("common.actions.edit")+this.subtitle:this.$t("common.actions.add")+this.subtitle,this.visible=!0},close:function(){this.visible=!1,this.icon="md-create",this.title=this.$t("common.actions.edit"),this.editing=!1},scrollTop:function(){var e=this.$refs.modal.$el,t=e.getElementsByClassName("ivu-modal-body");if(t&&t.length>0){var n=t[0];n&&n.scroll&&this.$nextTick((function(){return n.scroll(0,0)}))}}},watch:{value:function(e){this.visible=e,this.title=this.subtitle},visible:function(e){!0===e&&this.scrollTop()},subtitle:function(e){this.title=e}}}),o=a,s=(n("7d9e"),n("2877")),c=Object(s["a"])(o,r,i,!1,null,"0f32854a",null),l=c.exports;t["a"]=l},a144:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("edit-modal",{ref:"editModal",staticClass:"custom-width",attrs:{loading:e.okLoading,subtitle:e.title},on:{cancel:e.cancel,ok:e.ok}},[n("Form",{ref:"editModalForm",attrs:{"label-width":85,model:e.editModal,rules:e.rules}},[n("Row",[n("Col",{attrs:{span:"24"}},[n("FormItem",{attrs:{label:e.$t("product.factory.device.title"),prop:"printer"}},[n("Select",{model:{value:e.editModal.printer,callback:function(t){e.$set(e.editModal,"printer",t)},expression:"editModal.printer"}},e._l(e.items,(function(t){return n("Option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1)],1),n("Col",{attrs:{span:"24"}},[n("FormItem",{attrs:{label:e.$t("common.actions.tag"),prop:"label"}},[n("Select",{attrs:{items:e.labels},model:{value:e.editModal.label,callback:function(t){e.$set(e.editModal,"label",t)},expression:"editModal.label"}},e._l(e.labels,(function(t){return n("Option",{key:t.code,attrs:{value:t.code}},[e._v(e._s(t.name))])})),1)],1)],1),n("Col",{attrs:{span:"24"}},[n("FormItem",{attrs:{label:e.$t("product.factory.tag.printLabel"),prop:"num"}},[n("Input",{attrs:{placeholder:e.$t("common.placeholders.plsInput")+e.$t("product.factory.tag.printLabel")},model:{value:e.editModal.num,callback:function(t){e.$set(e.editModal,"num",t)},expression:"editModal.num"}})],1)],1)],1)],1)],1)],1)},i=[],a=(n("3b2b"),n("4917"),n("7f7f"),n("7514"),n("96cf"),n("1da1")),o=n("8eac"),s=n("b627"),c=n("7d96"),l=n("969c"),u=n("e4fd"),d=n("7638"),p=n("1693"),f=n("f121"),m=n("b893"),h=n("65f9"),b=1e4,v={name:"print-tag",inheritAttrs:!1,mixins:[s["a"]],props:{rows:{type:Array,default:function(){return[]}},code:{type:String},type:{type:String},title:{type:String},show:{type:Boolean,default:!0}},components:{editModal:o["a"]},created:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.inintDevicesByStationCode();case 2:if(e.t0=this.code,!e.t0){e.next=6;break}return e.next=6,this.initLabels(this.code);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),mounted:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.$refs.editModal.open();case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),data:function(){var e=this;return{okLoading:!1,editModal:{label:"",printer:""},workCenterCode:"",items:[],labels:[],rules:{num:[{required:!0,message:this.$t("common.placeholders.plsInput")},{trigger:"blur",validator:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(n,r,i){var a,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=e.editModal.num,o=/^[1-9]{1}[0-9]*$/.test(a)&&parseInt(a)>0&&parseInt(a)<=b,!0===o?i():i(e.$t("validate.number.section",{min:1,max:b}));case 3:case"end":return t.stop()}}),t)})));function n(e,n,r){return t.apply(this,arguments)}return n}()}],printer:[{required:!0,message:this.$t("common.placeholders.plsSelect")}],label:[{required:!0,message:this.$t("common.placeholders.plsSelect")}]}}},methods:{initLabels:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){var n,r,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,l["getLabelGroupByCode"](t);case 2:n=e.sent,r=n&&n.labels||[],this.labels=r,r.length&&(i=r.find((function(e){return e.isDefault})),a=i||r[0],this.editModal.label=a.code);case 6:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),inintDevicesByStationCode:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,c["pagination"]({code:this.$userInfo.workStation});case 2:t=e.sent,n=t.list.length&&t.list[0],r=n.devices.filter((function(e){return e.deviceType===d["g"]&&e.status==f["j"].ONLINE})),this.items=r,r.length&&(this.editModal.printer=r[0].id,this.workCenterCode=n.workCenter);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),ok:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$refs.editModalForm.validate();case 2:if(t=e.sent,t){e.next=5;break}return e.abrupt("return",!1);case 5:return this.okLoading=!0,e.next=8,this.print();case 8:if(n=e.sent,this.okLoading=!1,n){e.next=12;break}return e.abrupt("return",!1);case 12:this.dialogVisible=!1,r=this.editModal.label,this.$emit("ok",{labelCode:r.code});case 15:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),print:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t,n,r,i,a,o,s,c,l,u,d,p,f,b,v,k,g,w,y;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=this.$userInfo.workStation,n=this.editModal,r=n.label,i=n.num,a=n.printer,o=this.items.find((function(e){return e.id===a})),s=this.labels.find((function(e){return e.code===r})),c=o.address,l=o.name,u=s.zpl,d=s.code,p=u.match(new RegExp("\\%\\w+\\%","gi")),f=Object(m["j"])(p,this.rows,this.type),b=f.length,e.prev=7,v=!0,k=0;case 10:if(!(k<i)){e.next=30;break}if(v){e.next=13;break}return e.abrupt("break",30);case 13:g=0;case 14:if(!(g<b)){e.next=27;break}return w=f[g],w[h["a"].qty]=k+1,w[h["a"].date]=Object(m["a"])(new Date,"yyyy-MM-dd"),e.next=20,this.printTag({url:c,printerName:l,zpl:u,labelCode:d,code:w.code,workStation:{code:t,name:t}},w);case 20:if(y=e.sent,y){e.next=24;break}return v=!1,e.abrupt("break",27);case 24:g++,e.next=14;break;case 27:k++,e.next=10;break;case 30:return e.abrupt("return",v);case 33:return e.prev=33,e.t0=e["catch"](7),e.abrupt("return",!1);case 36:case"end":return e.stop()}}),e,this,[[7,33]])})));function t(){return e.apply(this,arguments)}return t}(),printTag:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s,c,l,d;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.url,i=t.printerName,a=t.zpl,o=t.code,s=t.workStation,c=t.labelCode,e.next=3,u["a"]({zpl:a,sn:o,labelGroupCode:this.code,workCenter:this.workCenterCode,workStation:s,operator:this.$userInfo.name,labelCode:c});case 3:if(l=e.sent,e.prev=4,e.t0=l,!e.t0){e.next=10;break}return e.next=9,u["b"]({url:r,data:Object.assign({template:a,type:f["s"].ZPL,printerName:i},n)});case 9:d=e.sent;case 10:if(!d.data||"fail"!==d.data.result){e.next=15;break}return this.$Message.error(this.$t("common.messages.printLabelError")),e.next=14,Object(p["b"])();case 14:return e.abrupt("return",!1);case 15:return e.abrupt("return",!0);case 18:return e.prev=18,e.t1=e["catch"](4),this.$Message.error(this.$t("common.messages.printLabelError")),e.next=23,Object(p["b"])();case 23:return e.abrupt("return",!1);case 24:case"end":return e.stop()}}),e,this,[[4,18]])})));function t(t,n){return e.apply(this,arguments)}return t}(),cancel:function(){this.$refs.editModal.close(),this.$emit("cancel")}}},k=v,g=n("2877"),w=Object(g["a"])(k,r,i,!1,null,null,null);t["default"]=w.exports},aebd:function(e,t,n){"use strict";n.r(t);var r=n("a144");t["default"]=r["default"]},e4fd:function(e,t,n){"use strict";n.d(t,"b",(function(){return u})),n.d(t,"a",(function(){return d}));n("96cf");var r=n("1da1"),i=n("bc3a"),a=n.n(i),o=n("f4c6"),s=n("4ae6"),c=n.n(s),l=n("f121");function u(e){var t=e.url,n=e.data;return a.a.post(t,{data:n})}function d(e){return p.apply(this,arguments)}function p(){return p=Object(r["a"])(regeneratorRuntime.mark((function e(t){var n,r,i,a=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:l["w"],r={mutation:c.a,variables:{data:t}},n&&(r.context={headers:n}),e.next=5,o["a"].mutate(r);case 5:return i=e.sent,e.abrupt("return",i.data.createLabelPrintHistory||null);case 7:case"end":return e.stop()}}),e)}))),p.apply(this,arguments)}}}]);