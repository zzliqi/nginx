(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3b5d9578","chunk-2d0cfeb7"],{5129:function(e,t,s){"use strict";var r=s("8917"),o=s.n(r);o.a},6689:function(e,t,s){"use strict";s.r(t),s.d(t,"client",(function(){return r}));var r="system"},"7c7c":function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("flex-panel",{staticClass:"user-group",attrs:{"hide-footer":!0,padding:0}},[s("p",{attrs:{slot:"title"},slot:"title"},[s("Icon",{attrs:{type:"ios-people"}}),e._v("\n    "+e._s(e.$t("system.usergroup.title"))+"\n  ")],1),s("actions",{staticClass:"actions",attrs:{slot:"extra",options:e.actionsOptions},on:{add:e.create,edit:e.modify,refresh:e.refresh,remove:e.remove},slot:"extra"}),s("CellGroup",{on:{"on-click":e.userGroupsClick}},e._l(e.userGroups,(function(t,r){return s("Cell",{key:t.id,attrs:{label:t.code,name:t.id,selected:e.selected&&e.selected.id===t.id,title:t.name}},[t.users.length>0?s("Poptip",{staticClass:"users-poptip",attrs:{slot:"extra",title:e.$t("system.usergroup.userlist"),placement:"right-start","popper-class":"permission-poptip-cls",trigger:"hover"},on:{"on-popper-show":function(t){return e.popperShow(r)}},slot:"extra"},[s("Badge",{attrs:{count:t.users.length,"class-name":"badge-users-count"}}),s("div",{staticClass:"user-list",attrs:{slot:"content"},slot:"content"},e._l(t.users,(function(t){return s("div",{key:t.id,staticClass:"user-item"},[s("div",{staticClass:"username"},[e._v(e._s(t.name))]),s("div",{staticClass:"personname"},[e._v(e._s(t.person&&t.person.name?t.person.name:""))])])})),0)],1):e._e()],1)})),1),s("edit-modal",{ref:"editModal",attrs:{modalWidth:640},on:{cancel:e.reset,ok:e.upsert}},[s("Form",{ref:"form",attrs:{"label-width":80,model:e.formModel,rules:e.rules}},[s("Row",[s("Col",{attrs:{span:"24"}},[s("FormItem",{attrs:{label:e.$t("system.usergroup.code"),prop:"code"}},[s("Input",{ref:"formCode",attrs:{disabled:e.isAdd,placeholder:e.$t("common.placeholders.plsInput")},model:{value:e.formModel.code,callback:function(t){e.$set(e.formModel,"code",t)},expression:"formModel.code"}})],1)],1)],1),s("Row",[s("Col",{attrs:{span:"24"}},[s("FormItem",{attrs:{label:e.$t("system.usergroup.name"),prop:"name"}},[s("Input",{attrs:{disabled:e.disEdit(),placeholder:e.$t("common.placeholders.plsInput")},model:{value:e.formModel.name,callback:function(t){e.$set(e.formModel,"name",t)},expression:"formModel.name"}})],1)],1)],1)],1)],1)],1)},o=[],i=(s("ac6a"),s("ac4d"),s("8a81"),s("5df3"),s("1c4c"),s("6b54"),s("96cf"),s("1da1")),n=(s("7f7f"),s("6689")),a=s("c9e5"),l=s("91f5"),d=s("f88e"),u=s("a250"),c=s("8eac"),m=s("70af"),f=s("7638");function p(e,t){var s;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(s=h(e))||t&&e&&"number"===typeof e.length){s&&(e=s);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,n=!0,a=!1;return{s:function(){s=e[Symbol.iterator]()},n:function(){var e=s.next();return n=e.done,e},e:function(e){a=!0,i=e},f:function(){try{n||null==s.return||s.return()}finally{if(a)throw i}}}}function h(e,t){if(e){if("string"===typeof e)return g(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);return"Object"===s&&e.constructor&&(s=e.constructor.name),"Map"===s||"Set"===s?Array.from(e):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?g(e,t):void 0}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,r=new Array(t);s<t;s++)r[s]=e[s];return r}var v={id:"",code:"",name:""},b="adminGroup",y={name:"user-group",components:{flexPanel:u["a"],actions:d["a"],editModal:c["a"]},mixins:[m["validMixins"]],apollo:{userGroups:{query:a["e"],client:n["client"],manual:!0,result:function(e){var t=this,s=e.data;if(this.userGroups=s.userGroups,this.userGroups.length>0){var r=this.selected;if(r){var o,i=p(this.userGroups);try{for(i.s();!(o=i.n()).done;){var n=o.value;n.id===r.id&&(r=n)}}catch(a){i.e(a)}finally{i.f()}}else r=this.userGroups[0];this.formModel=Object.assign({},r),this.$nextTick().then((function(){t.$emit("changed",Object.assign({},r),t.selected),t.selected=r}))}}}},props:{isActive:Boolean},data:function(){var e=this,t=function(t,s,r){var o=e.$_.trim(e.formModel.code);e.$_.isEmpty(o)?r():e.uniqueCodeValidate(r,e.formModel.code,e.formModel.id)},s=function(t,s,r){var o=e.$_.trim(e.formModel.name);e.$regex.nameReg.test(o)?e.uniqueNameValidate(r,e.formModel.name,e.formModel.id):r(new Error(e.$t("validate.nameReg",{name:e.$t("system.workStation.name")})))};return{userGroups:[],selected:null,isAdd:!1,isSubmit:!1,formModel:Object.assign({},v),rules:{code:[{required:!0,pattern:/^[a-zA-Z0-9\-_]{4,10}$/,message:this.$t("system.usergroup.messages.codeRule"),trigger:"blur"},{validator:t,trigger:"blur"}],name:[{required:!0,message:this.$t("system.usergroup.messages.nameRule"),trigger:"blur"},{validator:s,trigger:"blur"}]},actionsOptions:{add:{visible:!0,disabled:!1,loading:!1},edit:{visible:!0,disabled:!1},remove:{visible:!0,disabled:!0},resetPassword:{visible:!0,disabled:!0}}}},methods:{popperShow:function(e){var t=document.getElementsByClassName("permission-poptip-cls"),s=t&&t[e],r=s&&window.getComputedStyle(s);s.style.overflowY="auto",s.style.backgroundColor="white";var o=r&&parseInt(r.top);s.style.height=document.body.clientHeight-o+"px"},userGroupsClick:function(e){var t,s=this.selected,r=p(this.userGroups);try{for(r.s();!(t=r.n()).done;){var o=t.value;if(o.id===e){this.$refs.form.resetFields();var i=null===this.selected||this.selected.id!==e,n=o;return this.selected=n,this.formModel=Object.assign({},n),!0===i&&this.$emit("changed",Object.assign({},n),Object.assign({},s)),void(this.selected&&"adminGroup"===this.selected.code?(this.actionsOptions.remove.disabled=!0,this.actionsOptions.edit.disabled=!0):(this.actionsOptions.remove.disabled=!1,this.actionsOptions.edit.disabled=!1))}}}catch(a){r.e(a)}finally{r.f()}},remove:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,s,r,o,i=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={value:this.selected.code},e.next=3,Object(l["e"])(t);case 3:if(s=e.sent,r=s.list.length,!(r>0)){e.next=8;break}return this.$Message.warning(this.$t("common.messages.dataIntegrityError")),e.abrupt("return");case 8:if(this.selected&&this.selected.id){e.next=11;break}return this.$Message.warning(this.$t("common.messages.plsSelectRow")),e.abrupt("return");case 11:if(!(this.selected.users&&this.selected.users.length>0)){e.next=14;break}return this.$Message.warning(this.$t("system.usergroup.hasUsers",{count:this.selected.users.length})),e.abrupt("return");case 14:o={id:this.selected.id},this.$apollo.mutate({mutation:a["c"],variables:{where:o},client:n["client"]}).then((function(){i.refresh(),i.$Message.success(i.$t("common.messages.removeSuccess"))})).catch((function(){i.$Message.error(i.$t("common.messages.removeFailure"))}));case 16:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),refresh:function(){this.$refs.form.resetFields(),this.selected=null,this.formModel=Object.assign({},v),this.$apollo.queries.userGroups.refetch()},create:function(){this.$refs.form.resetFields(),this.selected=null,this.isAdd=!1,this.formModel=Object.assign({},v),this.$refs.editModal.open()},modify:function(){this.isAdd=!0,this.$refs.editModal.open(!0)},reset:function(){this.$refs.form.resetFields(),this.isAdd=!1,this.formModel=Object.assign({},this.selected||v),this.$refs.editModal.close()},upsert:function(){var e=this,t=!this.formModel.id;this.isSubmit=!0,this.$refs.form.validate((function(s){if(!s)return e.$Message.error(e.$t("common.rules.validateFailure")),void(e.isSubmit=!1);var r=e.formModel.id?{id:e.formModel.id}:{code:e.formModel.code},o={code:e.formModel.code,name:e.formModel.name,description:e.formModel.description};e.$apollo.mutate({mutation:a["d"],variables:{where:r,create:o,update:o}}).then((function(s){!0===t?e.refresh(s.data.node.id):(Object.assign(e.selected,s.data.node),e.$apollo.queries.userGroups.refetch()),e.$refs.editModal.close(),e.isAdd=!1,e.$Message.success(e.$t("common.messages.saveSuccess")),setTimeout((function(){e.isSubmit=!1}),1e3)})).catch((function(){e.isAdd=!0,e.$Message.error(e.$t("common.messages.saveFailure"))}))}))},uniqueCodeValidate:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,s){var r,o=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=o.length>2&&void 0!==o[2]?o[2]:"",e.next=3,this.validUnique({propName:"code",propVal:s,id:r,moduleName:f["e"].UserGroup},t);case 3:case"end":return e.stop()}}),e,this)})));function t(t,s){return e.apply(this,arguments)}return t}(),uniqueNameValidate:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,s){var r,o=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=o.length>2&&void 0!==o[2]?o[2]:"",e.next=3,this.validUnique({propName:"name",propVal:s,id:r,moduleName:f["e"].UserGroup},t);case 3:case"end":return e.stop()}}),e,this)})));function t(t,s){return e.apply(this,arguments)}return t}(),disRemove:function(){var e=this.selected;return!(e&&e.id&&e.code!==b)},disEdit:function(){var e=this.selected;if(e&&e.code===b)return!0}}},$=y,w=(s("b4ca"),s("2877")),M=Object(w["a"])($,r,o,!1,null,"74fa92b6",null);t["default"]=M.exports},8917:function(e,t,s){},a250:function(e,t,s){"use strict";var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Card",{staticClass:"flex-panel",attrs:{border:e.border,"dis-hover":e.disHover,icon:e.icon,padding:0,shadow:e.shadow,title:e.title}},[e.hideHeader?e._e():e._t("title",null,{slot:"title"}),e.hideHeader?e._e():e._t("extra",null,{slot:"extra"}),s("div",{staticClass:"flex-panel-body",style:{padding:e.padding+"px"}},[e._t("default")],2),e.hideFooter?e._e():s("div",{staticClass:"flex-panel-footer"},[e._t("footer")],2)],2)},o=[],i=(s("c5f6"),{name:"flex-panel",props:{border:{type:Boolean,default:!0},disHover:{type:Boolean,default:!1},shadow:{type:Boolean,default:!1},padding:{type:Number,default:16},icon:{type:String,default:""},title:{type:String,default:""},hideFooter:{type:Boolean,default:!1},hideHeader:{type:Boolean,default:!1}}}),n=i,a=(s("5129"),s("2877")),l=Object(a["a"])(n,r,o,!1,null,"7989b626",null),d=l.exports;t["a"]=d},b4ca:function(e,t,s){"use strict";var r=s("eb42"),o=s.n(r);o.a},eb42:function(e,t,s){}}]);