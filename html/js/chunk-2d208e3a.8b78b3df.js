(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d208e3a"],{a75c:function(n,e,t){"use strict";t.r(e);t("8e6e"),t("456d"),t("ac6a"),t("ac4d"),t("8a81"),t("5df3"),t("1c4c"),t("7f7f"),t("6b54");var i=t("8785"),r=(t("20d6"),t("7514"),t("ade3")),o=t("c9e5"),s=t("1863"),c=t("4c31"),a=t("6689"),u=t("9530"),d=t.n(u),h=t("cb37"),f=t("a250"),l=t("b12b"),m=t("2f62"),p=t("f121");function g(){var n=Object(i["a"])(["\n      mutation {\n        deleteManyPermissions(where: {\n          menu: {\n            id_in: [",']\n          },\n          userGroup:{ id:"','"} }) {\n          count\n        }\n\n        ',"\n      }\n\n      ",""]);return g=function(){return n},n}function v(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,i)}return t}function $(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?v(Object(t),!0).forEach((function(e){Object(r["a"])(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):v(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function b(n,e){var t;if("undefined"===typeof Symbol||null==n[Symbol.iterator]){if(Array.isArray(n)||(t=y(n))||e&&n&&"number"===typeof n.length){t&&(n=t);var i=0,r=function(){};return{s:r,n:function(){return i>=n.length?{done:!0}:{done:!1,value:n[i++]}},e:function(n){throw n},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){t=n[Symbol.iterator]()},n:function(){var n=t.next();return s=n.done,n},e:function(n){c=!0,o=n},f:function(){try{s||null==t.return||t.return()}finally{if(c)throw o}}}}function y(n,e){if(n){if("string"===typeof n)return G(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);return"Object"===t&&n.constructor&&(t=n.constructor.name),"Map"===t||"Set"===t?Array.from(n):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?G(n,e):void 0}}function G(n,e){(null==e||e>n.length)&&(e=n.length);for(var t=0,i=new Array(e);t<e;t++)i[t]=n[t];return i}var k=Object(m["a"])("app"),w=k.mapGetters;e["default"]={name:"menu-tree",components:{menuTreeItem:l["default"],flexPanel:f["a"]},props:{groupId:{type:String,default:""}},apollo:{menus:{query:o["b"],client:a["client"],manual:!0,result:function(n){var e=n.data;this.generateMenus(e)}}},data:function(){return{permissionGroupCode:p["v"].system.signManage.signPermControl,menus:{},nested:{menus:[],$opened:[]},group:"base",mutateLoading:!1,loading:!1,rawFlatMenus:[],permissionList:[]}},beforeMount:function(){},mounted:function(){},methods:{getSignPermission:function(){var n=this,e=this;this.$apollo.query({client:a["client"],query:c["c"],variables:{where:{}}}).then((function(t){e.permissionList=t.data.list,n.checkMenus()})).catch((function(e){console.error(e),n.loading=!1}))},generateMenus:function(n){var e=this;n=JSON.parse(JSON.stringify(n));var t=n.menus;this.buildFlatData(t),t&&t.length>0&&this.$set(this.nested,"menus",t),this.$nextTick().then((function(){e.$set(e.nested,"$opened",t.map((function(n){return n.id})))}))},buildFlatData:function(n){var e,t=this,i=b(n);try{var r=function(){var n=e.value;n.$parentId=n.parent&&n.parent.id?n.parent.id:null,n.$checked=!1,n.$indeterminate=!1,n.$permission=null,n.menuType===h["a"].internal&&0===n.menus.length?n.actionGroups=n.actionGroups.map((function(e){var t=$($({},e),{},{$checked:!1,$menu:n});return t})):n.actionGroups=[],n.$isChanged=function(){return t.isMenuChanged(n)},n.$opened=n.menus.map((function(n){return n.id})),t.menus[n.id]=n,n.menus&&n.menus.length>0&&t.buildFlatData(n.menus)};for(i.s();!(e=i.n()).done;)r()}catch(o){i.e(o)}finally{i.f()}},refresh:function(){},expandAll:function(){},collapsedAll:function(){},uncheckedAll:function(){for(var n in this.menus){this.$set(this.menus[n],"$checked",!1),this.$set(this.menus[n],"$indeterminate",!1),this.$set(this.menus[n],"$permission",null);for(var e=this.menus[n].actionGroups,t=e&&e.length,i=0;i<t;i++)for(var r=e[i].actions,o=r.length,s=0;s<o;s++)this.$set(r[s],"$checked",!1)}},checkIndeterminate:function(n){if(n=n||this.nested,n&&n.children&&n.children.length>0){var e=this.$_.filter(n.children,(function(n){return!0===n.$checked||!0===n.$indeterminate})),t=e.length>0&&e.length<n.children.length;n.$indeterminate=t;for(var i=0;i<n.children.length;i++)this.checkIndeterminate(n.children[i])}},actionsChangedMethod:function(n,e,t,i){var r=this;if(n&&n.id&&this.menus[n.id]&&e){var o,s;this.loading=!0,n.module&&n.module.id?(o=n.module.id,s={connect:{id:o}}):s=null;var a=!0===t?{id:e.id}:"",u={connect:a},d="";this.permissionList.length>0&&(d=this.permissionList.find((function(n){return n.action.id==e.id})));var h={connect:{id:this.groupId}},f={id:d?d.id:""},l={module:s,action:u,group:h};this.$apollo.mutate({mutation:c["b"],variables:{where:f,create:l,update:l},context:{headers:{"module-code":i,"action-id":this.addActionId}}}).then((function(n){n.data.node&&n.data.node.id&&r.getSignPermission()})).catch((function(n){r.getSignPermission(),console.error(n)}))}},actionsDeleteMethod:function(n,e){var t=this;if(n&&n.id){var i=this.$_.find(this.permissionList,(function(e){return e.action.id===n.id}));this.loading=!0;var r={id:i.id};this.$apollo.mutate({mutation:c["a"],variables:{where:r},context:{headers:{"module-code":e,"action-id":this.cancelActionId}},client:a["client"]}).then((function(){t.getSignPermission(),t.$Message.success(t.$t("common.messages.removeSuccess"))})).catch((function(){t.getSignPermission(),t.$Message.error(t.$t("common.messages.removeFailure"))}))}},actionsChanged:function(n,e,t){var i=window.sessionStorage.getItem(p["n"]);t?this.actionsChangedMethod(n,e,t,i):this.actionsDeleteMethod(e,i)},getCheckedMenus:function(){var n=[];for(var e in this.menus){var t=this.menus[e];if(!0===t.$checked||!0===t.$indeterminate){var i=[];if(t.children&&t.children.length>0);else{var r,o=b(t.actions);try{for(o.s();!(r=o.n()).done;){var s=r.value;!0===s.$checked&&i.push(s.id)}}catch(c){o.e(c)}finally{o.f()}}n.push({menu:{id:e},actions:i})}}return n},setCheckedMenus:function(n){var e=this;if(this.uncheckedAll(),n&&Array.isArray(n)&&!(n.length<1)){var t,i=b(n);try{var r=function(){var n=t.value;if(n.menu&&n.menu.id&&e.menus[n.menu.id]){var i,r=e.menus[n.menu.id];if(e.$set(r,"$permission",n),e.$set(r,"$checked",!0),n.permissionGroups&&(i=n.permissionGroups.length)&&i)for(var o=function(t){for(var i=n.permissionGroups[t].actions,o=e.$_.find(r.actionGroups,(function(e){return e.id===n.permissionGroups[t].actionGroup.id})),s=o&&o.actions.length||0,c=function(n){e.$set(o.actions[n],"$checked",-1!==e.$_.findIndex(e.permissionList,(function(e){return e.action.id===o.actions[n].id}))),e.$set(o.actions[n],"$group",e.$_.find(e.permissionList,(function(e){return e.action.id===o.actions[n].id})));var t=-1!==e.$_.findIndex(i,(function(e){return e.id===o.actions[n].id})),r=e.$_.find(i,(function(e){return e.id===o.actions[n].id})),s=!1,c=!!t&&r.signature;t?s=!(!c&&"undefined"!=typeof c&&0!=c)&&r.signature:c=!1,e.$set(o.actions[n],"$disabled",t&&s)},a=0;a<s;a++)c(a)},s=0;s<i;s++)o(s)}};for(i.s();!(t=i.n()).done;)r()}catch(o){i.e(o)}finally{i.f()}this.checkIndeterminate()}},getParents:function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(n&&n.parent&&n.parent.id&&this.menus[n.parent.id]){var t=this.menus[n.parent.id];this.getParents(t,e),e.push(t)}return e},getChildren:function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(n&&n.children&&n.children.length>0)for(var t=0;t<n.children.length;t++)e.push(n.children[t]),this.getChildren(n.children[t],e);return e},isMenuChanged:function(n){if(!n)return!1;var e=n.$permission;if((!0===n.$checked||!0===n.$indeterminate)&&!e)return!0;if(!0!==n.$checked&&!0!==n.$indeterminate&&e)return!0;if(!0!==n.$checked&&!0!==n.$indeterminate&&!e)return!1;var t=n.actions,i=e.actions;if(t&&t.length>0&&i){var r=this.$_.filter(t,(function(n){return!0===n.$checked}));if(r.length!==i.length)return!0;if(r.length>0){var o=r.map((function(n){return n.id})),s=i.map((function(n){return n.id})),c=this.$_.xor(o,s);if(c.length>0)return!0}}return!1},generateGraphqlVariables:function(n){var e={},t={group:this.group,userGroup:{connect:{id:this.userGroup.id,code:this.userGroup.code}}},i={};e.id=n.$permission&&n.$permission.id?n.$permission.id:"",t.menu={connect:{id:n.id}},t.actions={connect:this.$_.filter(n.actions,(function(n){return!0===n.$checked})).map((function(n){return{id:n.id}}))};var r=n.actions.map((function(n){return n.id})),o=n.$permission&&n.$permission.actions&&n.$permission.actions.length>0?n.$permission.actions.map((function(n){return n.id})):[],s=this.$_.difference(r,o).map((function(n){return{id:n}})),c=this.$_.difference(o,r).map((function(n){return{id:n}}));return i.actions={connect:s,disconnect:c},{where:e,create:t,update:i}},generateCreateGraphql:function(n){var e="[",t=n.actionGroups.length;if(n.actionGroups&&t)for(var i=0;i<t;i++){for(var r=n.actionGroups[i].actions,o=r.length,s="",c=0;c<o;c++)!0===r[c].$checked&&(s+='{id: "'.concat(r[c].id,'"}, '));e+='{\n            actionGroup: {\n              connect: {\n                id: "'.concat(n.actionGroups[i].id,'"\n              }\n            }\n            actions: {\n              connect: [').concat(s,"]\n            }\n          }, ")}e+="]";var a="\n      ".concat(n.id,': createPermission(\n        data: {\n          menu: { connect: { id: "').concat(n.id,'" } }\n          userGroup: {\n            connect: {\n              id: "').concat(this.groupId,'"\n            }\n          }\n          permissionGroups: {\n            create: ').concat(e,"\n          }\n        }\n      ) {\n        ...fields\n      }\n      ");return a},generateGraphql:function(){var n="",e="";for(var t in this.menus){var i=this.menus[t];e+=', "'.concat(i.id,'"'),!0!==i.$checked&&!0!==i.$indeterminate||(n+="\n          ".concat(this.generateCreateGraphql(i),"\n          "))}if(""===e)return"";e=this.$_.trim(e,",");var r=""===n?"":"\n      fragment fields on Permission {\n        id\n        userGroup {\n          id\n          code\n          name\n        }\n        menu {\n          id\n          name\n        }\n        permissionGroups {\n          id\n          actionGroup {\n            id\n            code\n            name\n            i18N\n          }\n          actions {\n            id\n            code\n            name\n            i18N\n          }\n        }\n      }",o=d()(g(),e,this.groupId,n,r);return o},checkMenus:function(){var n=this;this.$apollo.query({client:a["client"],query:s["c"],variables:{where:{}}}).then((function(e){var t=e.data.permissions||[];n.setCheckedMenus(t),n.loading=!1})).catch((function(e){console.error(e),n.loading=!1}))}},watch:{groupId:function(){this.loading=!0,this.getSignPermission()}},computed:$({isLoading:function(){return this.loading||this.$apollo.loading},groupActions:function(){var n=this,e=function n(e,t){for(var i=e.length,r=0;r<i;r++){var o=e[r];if(o.url===t)return o;if(o.menus.length){var s=n(o.menus,t);if(s)return s}}},t=e(this.$menus,p["t"]),i=t.actionGroups,r=i.find((function(e){return e.code===n.permissionGroupCode}));return r&&r.actions||[]},addActionId:function(){var n=this.groupActions.find((function(n){return n.code===p["b"]}));return n&&n.id||""},cancelActionId:function(){var n=this.groupActions.find((function(n){return n.code===p["f"]}));return n&&n.id||""}},w({$menus:"menus",$groupActions:"groupActions"}))}}}]);