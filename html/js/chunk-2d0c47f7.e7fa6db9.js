(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0c47f7"],{"3aa4":function(e,t,i){"use strict";i.r(t);i("8e6e"),i("ac6a"),i("456d");var a=i("ade3"),r=(i("96cf"),i("1da1")),o=i("6689"),s=i("e7f7"),d=i("3595"),n=i("ccdb"),l=i("2211"),c=i("083f"),u=i("9b95"),g=i("8eac");function m(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function p(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?m(Object(i),!0).forEach((function(t){Object(a["a"])(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):m(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}t["default"]={name:"data-dictionary",components:{actions:u["a"],editModal:g["a"]},mixins:[s["a"]],data:function(){var e=this,t=function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(i,a,r){var s,d,n,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.$regex.commonUse().test(e.editModal.data.groupCode)){t.next=4;break}r(new Error(e.$t("validate.commonUse.infinite",{name:e.$t("system.dictionary.value")}))),t.next=14;break;case 4:if(e.$_.isEmpty(e.$_.trim(e.editModal.data.groupCode))){t.next=13;break}return s=e.editModal.data.id||null,d=e.editModal.data.groupCode,n=e.$t("system.dictionary.messages.uniqueGroupCodeAndValue",{groupCode:d,value:a}),l={id_not:s,groupCode:d,value:a},t.next=11,Object(c["a"])(o["client"],"DataDictionary",l,r,n);case 11:t.next=14;break;case 13:r();case 14:case"end":return t.stop()}}),t)})));return function(e,i,a){return t.apply(this,arguments)}}();return{gridOptions:this.$_.assign(this.$agGetDefaultGridOptions(),{onGridReady:this.gridReady.bind(this),onSelectionChanged:this.selectionChanged.bind(this),pagination:!0,columnDefs:[{type:["rowNumberColumn"]},{headerName:this.$t("system.dictionary.groupCode"),field:"groupCode",filter:"agTextColumnFilter"},{headerName:this.$t("system.dictionary.label"),field:"label"},{headerName:this.$t("system.dictionary.value"),field:"value",cellRendererFramework:n["a"]},{headerName:this.$t("system.dictionary.orderNo"),field:"orderNo",filter:"agNumberColumnFilter"},{headerName:this.$t("common.labels.createdAt"),field:"createdAt",cellRendererFramework:d["a"],width:200,filter:"agDateColumnFilter"},{headerName:this.$t("common.labels.updatedAt"),cellRendererFramework:d["a"],field:"updatedAt",filter:"agDateColumnFilter",width:200,sort:"desc"},{headerName:this.$t("common.labels.description"),field:"description",filter:"agTextColumnFilter"}]}),gridApi:null,columnApi:null,editModal:{loading:!1,visible:!1,data:this.getDefaultData(),rules:{groupCode:[{required:!0,message:this.$t("common.rules.plsInput"),trigger:"blur"},{validator:function(t,i,a){e.$regex.commonUse().test(i)?a():a(new Error(e.$t("validate.commonUse.infinite",{name:e.$t("system.dictionary.groupCode")})))},trigger:"change"}],label:[{required:!0,message:this.$t("common.rules.plsInput"),trigger:"blur"},{validator:function(t,i,a){e.$regex.nameReg.test(i)?a():a(new Error(e.$t("validate.nameReg",{name:e.$t("system.dictionary.label")})))}}],value:[{required:!0,message:this.$t("common.rules.plsInput"),trigger:"blur"},{validator:t,trigger:"blur"}],orderNo:[{required:!0,type:"number",trigger:"blur",message:this.$t("common.rules.plsInput")}],description:[{message:this.$t("common.rules.plsInput")},{validator:function(t,i,a){e.$regex.special.test(i)?a(new Error(e.$t("validate.special"))):a()},trigger:"change"}]}},actionsOptions:{edit:{visible:!0,disabled:!0},remove:{visible:!0,disabled:!0}},isAllowDefaultSelected:!0}},methods:{gridReady:function(e){this.gridApi=e.api,this.columnApi=e.columnApi,this.gridApi.sizeColumnsToFit(),e.api.setServerSideDatasource(this.serverSideDatasource())},selectionChanged:function(e){var t=e.api.getSelectedRows();this.actionsOptions.remove.disabled=this.actionsOptions.edit.disabled=!(t&&t.length>0)},getDefaultData:function(){return{groupCode:"",label:"",value:"",description:"",orderNo:0}},add:function(){this.editModal.data=this.getDefaultData(),this.$refs.editModalForm.resetFields(),this.editModal.loading=!1,this.$refs.editModal.open()},edit:function(){this.$refs.editModalForm.resetFields();var e=this.getSelectedNode();e?(this.editModal.data=p({},e.data),this.editModal.loading=!1,this.$refs.editModal.open(!0)):this.$Message.warning(this.$t("common.messages.plsSelectRow"))},cancel:function(){!0!==this.editModal.loading&&(this.editModal.data=this.getDefaultData(),this.editModal.loading=!1,this.$refs.editModal.close())},ok:function(){var e=this;this.editModal.loading=!0,this.$refs.editModalForm.validate((function(t){if(t){var i=e.editModal.data,a=i.id,r=i.groupCode,s=i.label,d=i.value,n=i.orderNo,c=i.description,u={groupCode:r,label:s,value:d,orderNo:n,description:c},g={where:{id:a||"undefined"},create:u,update:u};e.$apollo.mutate({mutation:l["c"],variables:g,client:o["client"]}).then((function(t){if(a){var i=e.getSelectedNode();i.setData(Object.assign(i.data,p({},t.data.node)))}else e.gridApi.setSortModel([{colId:"createdAt",sort:"desc"}]);e.$refs.editModal.close(),e.editModal.loading=!1,e.$Message.success(e.$t("common.messages.saveSuccess"))})).catch((function(){e.editModal.loading=!1,e.$Message.error(e.$t("common.messages.saveFailure"))}))}else e.editModal.loading=!1,e.$Message.error(e.$t("common.rules.validateFailure"))}))},getSelectedNode:function(){var e=this.gridApi.getSelectedNodes();return e&&e.length>0&&e[0]&&e[0].id?e[0]:null},remove:function(){var e=this,t=this.getSelectedNode();if(t){var i=t.id;this.$apollo.mutate({mutation:l["b"],variables:{id:i},client:o["client"]}).then((function(){e.gridApi.deselectAll(),e.gridApi.purgeServerSideCache(),e.$Message.success(e.$t("common.messages.removeSuccess"))})).catch((function(){e.$Message.error(e.$t("common.messages.removeFailure"))}))}else this.$Message.warning(this.$t("common.messages.plsSelectRow"))},refresh:function(){this.gridApi.purgeServerSideCache()},serverSideDatasource:function(){var e=this;return{getRows:function(t){var i=t.request,a={skip:i.startRow,first:i.endRow-i.startRow};a.orderBy=e.$agGenerateOrderByFromSortModel(i.sortModel);var r=e.$agGenerateWhereFromFiltersModel(t.request.filterModel);a.where=r,e.$apollo.query({query:l["a"],variables:a,client:o["client"]}).then((function(i){var a=i.data;t.successCallback(a.list,a.total.aggregate.count);var r=e.gridApi.getSelectedNodes();if(e.isAllowDefaultSelected)if(r.length>0)for(var o=0;o<a.list.length;o++)a.list[o].id!=r[0].id&&e.gridApi.getRenderedNodes()[0].setSelected(!0);else e.gridApi.getRenderedNodes()[0].setSelected(!0);else r.length>0&&e.deselectAll()}))}}}}}}}]);