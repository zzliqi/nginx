(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0f0b46"],{"9e04":function(e,t,i){"use strict";i.r(t);i("6762"),i("2fdb"),i("28a5"),i("ac6a"),i("96cf");var a=i("1da1"),r=(i("4917"),i("7f7f"),i("3b2b"),i("7514"),i("53ca")),n=i("23f4"),s=i("9b95"),o=i("9974b"),d=i("e7f7"),c=i("db25"),l=i("3595"),u=i("cdde"),p=i("8eac"),m=i("a434"),h=i("b441"),f=i("5db7");t["default"]={name:"application-resource-manager",components:{oneTabel:n["b"],actions:s["a"],editModal:p["a"]},mixins:[d["a"],c["a"]],data:function(){var e=this,t=this,i=30,a=5e3,r=function(r,n,s){i=e.isTextarea?a:i,""===n.trim()?s(new Error(t.$t("common.rules.plsInputOrUpload"))):("TEXT"===t.editModal.data.type&&n.trim().length>i&&s(new Error(t.$t("common.rules.limitLength",{max:i}))),s())};return{textareaTypeCode:["copyrightActivationCode"],applicationResourceEnum:m["DEFAULT_APPLICATION_RESOURCE_ENUM"],imageUrlPrefix:h["VUE_APP_FILES_ROOT"],uploadUrl:h["VUE_APP_FILES_ROOT"]+"upload/appresource",timestamp:(new Date).getTime(),imgPreviewSrc:"",uploadDisabled:!1,modules:o["a"],gridOptions:this.$_.assign(this.$agGetDefaultGridOptions(),{onGridReady:t.onGridReady,onSelectionChanged:t.onSelectionChanged,pagination:!0,columnDefs:[{type:["rowNumberColumn"]},{headerName:this.$t("common.labels.code"),field:"code",sort:"asc"},{headerName:this.$t("common.labels.type"),field:"type"},{headerName:this.$t("common.labels.info"),field:"info"},{headerName:this.$t("common.labels.createdAt"),field:"createdAt",cellRendererFramework:l["a"],filter:"agDateColumnFilter",width:200},{headerName:this.$t("common.labels.updatedAt"),cellRendererFramework:l["a"],field:"updatedAt",filter:"agDateColumnFilter",width:200},{headerName:this.$t("common.labels.description"),field:"description",filter:"agTextColumnFilter"}]}),gridApi:null,columnApi:null,selectedRow:null,modalConfirmActionType:"add",actionsOptions:{add:{visible:!0,disabled:!1,loading:!1},edit:{visible:!0,disabled:!0},remove:{visible:!0,disabled:!0}},editModal:{loading:!1,visible:!1,data:t.getDefaultSqlFragment(),rules:{code:[{required:!0,message:this.$t("common.rules.plsSelect"),trigger:"change"}],info:[{validator:r,trigger:"change"}]}}}},methods:{onGridReady:function(e){var t=e.api,i=e.columnApi;this.gridApi=t,this.columnApi=i,this.gridApi.sizeColumnsToFit();var a=this.createDatasource();this.gridApi.setServerSideDatasource(a)},existI18N:function(e){var t=this.$t(e);return!0===this.$te(e)&&"object"!==Object(r["a"])(t)},cancelEditModal:function(){this.disabledSomeAction(),this.$refs.editModalVueComponent.close(),this.$refs.editModalFormVueComponent.resetFields(),this.gridApi.deselectAll(),this.uploadDisabled=!1},getDefaultSqlFragment:function(){return{code:"",info:"",description:"",type:""}},handleCodeChange:function(e){if(e){var t=this.applicationResourceEnum.find((function(t){return t.code==e}));try{this.editModal.data.type=t.type,this.editModal.data.info="",this.editModal.data.description=t.description,this.editModal.data.code=e}catch(i){this.$Message.error(this.$t("common.messages.empty"))}}},handleUploadProgress:function(){},handleExceedSize:function(){this.uploadDisabled=!1,this.$Message.error(this.$t("common.messages.fileExceedSize"))},beforeUpload:function(e){var t=new RegExp(/.jpg|.jpeg|.gif|.png|.ico/i),i=e.name.substring(e.name.lastIndexOf("."));return i.match(t)?(this.uploadDisabled=!0,!0):(this.$Message.error(this.$t("common.messages.errorFileType")),this.uploadDisabled=!1,!1)},uploadSuccess:function(e,t,i){var r=this,n=e.data,s=e.error,o=e.code;if(n&&n[0].url)return this.editModal.data.info=n[0].url,this.uploadDisabled=!1,void(this.timestamp=(new Date).getTime());s&&(o&&"EXISTSFILE"===o||"DUPLICATENAME"===o?this.$Modal.confirm({title:this.$t("common.messages.tips"),content:this.$t("common.messages.fileExistAndWantToDelete"),loading:!0,onOk:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.deleteFile(t.name);case 3:e.sent,r.$Message.info(r.$t("common.messages.removeSuccess")),r.$Modal.remove(),r.editModal.data.info="",e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](0),r.$Message.error(r.$t("common.messages.removeFailure"));case 12:return e.prev=12,r.uploadDisabled=!1,e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[0,9,12,15]])})));function i(){return e.apply(this,arguments)}return i}(),onCancel:function(){r.uploadDisabled=!1}}):(this.$Message.error(s),this.uploadDisabled=!1))},uploadError:function(e,t,i){this.$Message.error(e),this.uploadDisabled=!1},enabledSomeAction:function(){this.actionsOptions.remove.disabled=!1,this.actionsOptions.edit.disabled=!1},disabledSomeAction:function(){this.actionsOptions.remove.disabled=!0,this.actionsOptions.edit.disabled=!0},deleteFile:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(f["a"])({url:"".concat(this.uploadUrl,"/").concat(t),baseURL:"",method:"DELETE"});case 2:return i=e.sent,e.abrupt("return",i);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),checkPostDataValide:function(){return""!=this.editModal.data.code.trim()&&""!=this.editModal.data.info.trim()},confirmEditModal:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t,i,a,r,n,s,o,d,c,l,p,m;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$refs.editModalFormVueComponent.validate();case 2:if(t=e.sent,i=this.checkPostDataValide(),t&&i){e.next=8;break}return this.editModal.loading=!1,this.$Message.error(this.$t("common.rules.validateFailure")),e.abrupt("return");case 8:return this.editModal.loading=!0,a=this.editModal.data,"add"==this.modalConfirmActionType&&(r={data:a},n=u["a"],s="createdAt"),"edit"==this.modalConfirmActionType&&(o=a.code,d=a.type,c=a.info,l=a.description,r={data:{code:o,type:d,info:c,description:l}},n=u["d"],p={id:a.id},r.where=p,s="updatedAt"),e.prev=12,e.next=15,this.callGraphQlMution(n,r,"system");case 15:m=e.sent,m.data.createAppResource||m.data.updateAppResource,this.$Message.success(this.$t("common.messages.saveSuccess")),this.gridApi.setSortModel([{colId:s,sort:"desc"}]),e.next=24;break;case 21:e.prev=21,e.t0=e["catch"](12),this.$Message.error(this.$t("common.messages.saveFailure"));case 24:return e.prev=24,this.disabledSomeAction(),this.$refs.editModalVueComponent.close(),this.$refs.editModalFormVueComponent.resetFields(),this.gridApi.deselectAll(),this.editModal.data=this.getDefaultSqlFragment(),e.finish(24);case 31:case"end":return e.stop()}}),e,this,[[12,21,24,31]])})));function t(){return e.apply(this,arguments)}return t}(),openEditModal:function(e){var t=!1,i=this;if(this.applicationResourceEnum.every((function(e){return e.disabled=!1,!0})),"add"==e){this.editModal.data=this.getDefaultSqlFragment();var a=this.gridApi.getRenderedNodes();a.forEach((function(e){var t=e.data,a=t.code;i.applicationResourceEnum.find((function(e){e.code===a&&(e.disabled=!0)}))}))}"edit"==e&&(this.editModal.data=Object.assign({},this.selectedRow),t=!0),this.timestamp=(new Date).getTime(),this.modalConfirmActionType=e,this.$refs.editModalVueComponent.open(t),this.editModal.loading=!1},remove:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t,i,a,r,n,s,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.selectedRow,i=t.id,t.code,a=t.type,r=t.info,n={where:{id:i}},s=u["b"],e.prev=3,e.next=6,this.callGraphQlMution(s,n,"system");case 6:if(o=e.sent,o.data.deleteAppResource,this.$Message.success(this.$t("common.messages.removeSuccess")),"FILE"!=a){e.next=12;break}return e.next=12,this.deleteFile(r.split("/").pop());case 12:e.next=17;break;case 14:e.prev=14,e.t0=e["catch"](3),this.$Message.error(this.$t("common.messages.removeFailure"));case 17:return e.prev=17,this.disabledSomeAction(),this.gridApi.deselectAll(),this.gridApi.purgeServerSideCache(),e.finish(17);case 22:case"end":return e.stop()}}),e,this,[[3,14,17,22]])})));function t(){return e.apply(this,arguments)}return t}(),onSelectionChanged:function(e){e.type;var t=e.api,i=(e.columnApi,t.getSelectedRows());i.length>0&&(this.selectedRow=i[0],this.enabledSomeAction())},callGraphQlMution:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t,i,a){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$apollo.mutate({mutation:t,variables:i,path:a});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e,this)})));function t(t,i,a){return e.apply(this,arguments)}return t}(),queryAllData:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t,i,a){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$apollo.query({query:t,variables:i,client:a});case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e,this)})));function t(t,i,a){return e.apply(this,arguments)}return t}(),createDatasource:function(){var e=this;return{getRows:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(i){var a,r,n,s,o,d,c,l;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=i.request,r=a.startRow,n=a.endRow-a.startRow,s=e.$agGenerateOrderByFromSortModel(a.sortModel),o=e.$agGenerateWhereFromFiltersModel(a.filterModel),d={skip:r,first:n,orderBy:s,where:o},t.prev=2,t.next=5,e.queryAllData(u["c"],d,"system");case 5:c=t.sent,l=c.data,i.successCallback(l.list,l.total.aggregate.count),t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](2),e.$Message.info(e.$t("common.messages.empty"));case 13:case"end":return t.stop()}}),t,null,[[2,10]])})));function i(e){return t.apply(this,arguments)}return i}()}}},mounted:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}(),computed:{isTextarea:function(){return this.textareaTypeCode.includes(this.editModal.data.code)}}}}}]);