(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0a34ab"],{"020c":function(e,t,i){"use strict";i.r(t);i("ac4d"),i("8a81"),i("5df3"),i("1c4c"),i("6b54"),i("8e6e"),i("456d");var n=i("53ca"),a=i("ade3"),r=(i("ac6a"),i("2909")),s=(i("7514"),i("20d6"),i("7f7f"),i("6689")),o=i("cb37"),c=i("1884"),d=i("2448"),l=i("c536"),u=i.n(l),h=i("b354"),f=i.n(h),p=i("2e4b"),g=i.n(p),v=i("723c"),m=i.n(v),N=i("1491"),$=i.n(N),b=i("9495"),w=i.n(b),y=i("88ee"),O=i.n(y),D=i("202d"),I=i.n(D),x=i("f121"),M=i("8dee"),S=i.n(M),T=i("f88e"),L=i("9b95");function C(e,t){var i;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(i=A(e))||t&&e&&"number"===typeof e.length){i&&(e=i);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,o=!1;return{s:function(){i=e[Symbol.iterator]()},n:function(){var e=i.next();return s=e.done,e},e:function(e){o=!0,r=e},f:function(){try{s||null==i.return||i.return()}finally{if(o)throw r}}}}function A(e,t){if(e){if("string"===typeof e)return P(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?P(e,t):void 0}}function P(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function j(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function G(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?j(Object(i),!0).forEach((function(t){Object(a["a"])(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):j(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var _=4,B="system.menu.",k=100,V={add:"add",edit:"edit",none:"none"},F=!1,E={code:S.a.generate(),name:"",menuType:"INTERNAL",url:"welcome",i18N:"",icon:c["DefaultIcon"],orderNo:k,description:"",actionGroups:[],enable:!0,$isNew:!0};t["default"]={name:"system-menu",components:{SlVueTree:u.a,MiniActions:T["a"],CommonActions:L["a"]},apollo:{modules:{query:I.a,client:s["client"]},actionBases:{query:g.a,client:s["client"]},menus:{query:f.a,client:s["client"],manual:!0,result:function(e){var t=this,i=e.data,n=e.loading,a=e.networkStatus;if(!n&&7===a&&i&&i.menus&&i.menus.length>0){this.menus=JSON.parse(JSON.stringify(i.menus));var r=this.buildNestNodes(this.menus);r[0].isSelected=!0,this.nodes=r,this.$nextTick((function(){t.$refs.slVueTree.select(t.selectNodePath,!0)}))}}}},data:function(){var e=this,t=this;return{menuGroupCode:x["v"].system.menu.groupOperate,editGroupCode:x["v"].system.menu.edit,editOptions:{save:{visible:!0,disabled:!1,type:"primary"},reset:{visible:!0,disabled:!1}},groupActionsOption:{add:{visible:!0,disabled:!1},remove:{visible:!0,disabled:!1},refresh:{visible:!1}},actionsOptions:{add:{visible:!0,disabled:!1},remove:{visible:!0,disabled:!1},upgrade:{visible:!0,disabled:!1},degrade:{visible:!0,disabled:!1},downward:{visible:!0,disabled:!1},upward:{visible:!0,disabled:!1}},i18nStart:B,maxLevel:_,defaultIcon:c["DefaultIcon"],state:V.none,selectNode:{data:{},isLoding:!0},selectNodeDataBackup:null,menus:[],nodes:[],groupIdDeletes:[],actionIdDeletes:{},selectNodePath:[0],formRules:{code:[{required:!0,pattern:/^[a-zA-Z0-9\-_]{1,20}$/,message:this.$t("".concat(B,"rules.code")),trigger:"change"}],name:[{required:!0,pattern:/^[a-zA-Z0-9\u4e00-\u9fa5\-_]{1,20}$/,message:this.$t("".concat(B,"rules.name")),trigger:"change"}],url:[{validator:function(i,n,a){if(t.selectNode){if(t.selectNode.children&&t.selectNode.children.length>0)return void a();""===n&&a(new Error(e.$t("".concat(B,"rules.url"))))}a()},trigger:"blur"}]},iconOptions:d["a"]}},methods:{moduleChange:function(e){!this.selectNode.data.name&&(this.selectNode.data.name=e.label)},openChangeBoxHandle:function(e){var t=this;this.actionBases=this.actionBases.map((function(i){return i.$disabled=t.$_.findIndex(e,(function(e){return e.code===i.code}))>-1,i.signature=!!i.signature,i}))},getActionByCode:function(e){return e&&this.actionBases.find((function(t){return t.code===e}))},changeOptionHandler:function(e,t){t.name=e&&e.label||"";var i=this.getActionByCode(e&&e.value);i&&(t.i18N=i.i18N)},addMenuGroup:function(){var e=this.$_.cloneDeep(this.actionBases[0]),t={name:this.selectNode.data.name,code:this.selectNode.data.code,actions:[Object.assign(e,{name:this.$t(e.i18N),signature:!1})]};this.selectNode.data.actionGroups.push(t)},removeMenuGroup:function(e,t){this.selectNode.data.actionGroups.splice(e,1),t&&this.groupIdDeletes.push({id:t})},addGroupActions:function(e){this.selectNode.data.actionGroups[e].actions.push({$id:this.$shortid(),code:"",name:""})},deleteGroupAction:function(e,t,i,n){this.selectNode.data.actionGroups[e].actions.splice(t,1),n&&i&&(this.actionIdDeletes[i]?this.actionIdDeletes[i].push(n):this.actionIdDeletes[i]=[n])},isUrlRequired:function(e){return!(e&&e.children&&e.children.length>0)},nodeSelected:function(e){this.selectNode=e[0],this.selectNodePath=this.selectNode.path,this.selectNodeDataBackup=this.$_.cloneDeep(e[0].data),this.updateActionStatus(this.selectNode)},resetSelectNodeData:function(){this.selectNode.data=this.$_.cloneDeep(this.selectNodeDataBackup)},getParentNode:function(e){var t=Object(r["a"])(e.path),i=this.$refs.slVueTree;return t.pop(),0===t.length?(this.$Notice.warning({name:this._noticeName,title:this.$t("common.tips"),duration:5,desc:this.$t(this.i18nStart+"tips",{maxLevel:this.maxLevel})}),null):i.getNode(t)},downward:function(){var e=this,t=this.selectNode;if(t.isLastChild)this.$Message.warning(this.getI18n("isLastChild"));else{var i=this.getParentNode(t),n=i.children[t.ind+1],a=n.data.orderNo,o=t.data.orderNo;this.$apollo.mutate({mutation:$.a,variables:{orgCode:t.data.code,orgOrderNo:a,targetCode:n.data.code,targetOrderNo:o},client:s["client"]}).then((function(){var i,n=e.$refs.slVueTree;n.traverse((function(e,n,s){if(n.data.code===t.data.code){var c=s[e.ind+1];i=Object(r["a"])(e.path);var d=s[e.ind];return d.data.orderNo=a,c.data.orderNo=o,s.splice(e.ind,1),s.splice(e.ind+1,0,d),!1}})),i[i.length-1]+=1,e.$nextTick((function(){n.select(i,!0)}))})).catch((function(){e.$Message.error(e.getI18n("downwardFailure"))}))}},upward:function(){var e=this,t=this.selectNode;if(t.isFirstChild||0===t.ind)this.$Message.warning(this.getI18n("isFirstChild"));else{var i=this.getParentNode(t),n=i.children[t.ind-1],a=n.data.orderNo,o=t.data.orderNo;this.$apollo.mutate({mutation:$.a,variables:{orgCode:t.data.code,orgOrderNo:a,targetCode:n.data.code,targetOrderNo:o},client:s["client"]}).then((function(){var i,n=e.$refs.slVueTree;n.traverse((function(e,n,s){if(n.data.code===t.data.code){var c=s[e.ind-1];i=Object(r["a"])(e.path);var d=s[e.ind];return d.data.orderNo=a,c.data.orderNo=o,s.splice(e.ind,1),s.splice(e.ind-1,0,d),!1}})),i[i.length-1]-=1,e.$nextTick((function(){n.select(i,!0)}))})).catch((function(){e.$Message.error(e.getI18n("upwardFailure"))}))}},degrade:function(){var e=this,t=this.selectNode,i=this.getMaxLevel(t);if(t.level===this.maxLevel||t.isFirstChild)this.$Message.warning(this.getI18n("notAllowDegrade"));else if(i>=this.maxLevel)this.$Message.warning(this.$t(this.i18nStart+"levelRule",{maxLevel:this.maxLevel}));else{var n=this.getParentNode(t),a=n.children[t.ind-1],r=k;a.children&&a.children.length>0&&(r=this.$_.maxBy(a.children,(function(e){return e.data.orderNo})).data.orderNo+1),this.$apollo.mutate({mutation:m.a,variables:{orgCode:n.data.code,code:t.data.code,targetCode:a.data.code,orderNo:r},client:s["client"]}).then((function(){var i,n,a,s=e.$refs.slVueTree;s.traverse((function(e,i,r){if(i.data.code===t.data.code)return 0!==e.ind&&(n=i,a=r[e.ind-1],r.splice(e.ind,1)),!1})),s.traverse((function(t,s){if(s.data.code===a.data.code)return s.children||(e.$set(s,"children",[]),e.$set(s,"isLeaf",!1)),i=t.path,n.data.orderNo=r,s.children.push(n),i.push(s.children.length-1),!1})),e.$nextTick((function(){e.$refs.slVueTree.select(i,!0)}))})).catch((function(){e.$Message.error(e.getI18n("degradeFailure"))}))}},upgrade:function(){var e=this,t=this.selectNode;if(t.level<=2)this.$Message.warning(this.getI18n("notAllowUpgrade"));else{var i=this.$refs.slVueTree,n=this.getParentNode(t),a=n.data,r=this.getParentNode(n),o=r.data;this.$apollo.mutate({mutation:m.a,variables:{orgCode:a.code,code:t.data.code,targetCode:o.code,orderNo:a.orderNo+1},client:s["client"]}).then((function(){var r;i.traverse((function(e,i,n){if(i.data.code===t.data.code)return r=i,n.splice(e.ind,1),!1}));var s=n.path;i.traverse((function(e,t,i){if(t.data.code===n.data.code)return r.data.orderNo=a.orderNo+1,i.splice(e.ind+1,0,r),!1})),e.$nextTick((function(){s[s.length-1]=s[s.length-1]+1,e.$refs.slVueTree.select(s,!0)}))})).catch((function(){e.$Message.error(e.getI18n("upgradeFailure"))}))}},remove:function(){var e=this,t=this.selectNode;if(1===t.level||t.children&&t.children.length)this.$Message.warning(this.getI18n("removeDisable"));else{var i=function(){var i=t.path,n=e.$refs.slVueTree;n.remove([i]),i.pop(),n.select(i,!0),t=e.selectNode,e.$set(t,"isLeaf",0===t.children.length),e.$Message.success(e.$t("common.removeSuccess"))};if(!0!==t.data.$isNew)this.$apollo.mutate({mutation:w.a,variables:{code:t.data.code},client:s["client"]}).then((function(){i()})).catch((function(){e.$Message.error(e.getI18n("removeFail"))}));else try{i()}catch(n){this.$Message.error(this.getI18n("removeFailure"))}}},create:function(){var e=this,t=this.selectNode;if(t.data.$isNew)this.$Message.warning(this.getI18n(NaN));else if(t.level!==this.maxLevel){var i=this.$refs.slVueTree,n=this.convertMenuToNode(Object.assign({},E));n.data.code=S.a.generate(),i.traverse((function(i,a){if(a.data.code!==t.data.code)return!0;if(a.children){var r=0;r=e.$_.minBy(a.children,(function(e){return e.data.orderNo})).data.orderNo,n.data.orderNo=r-1}else e.$set(a,"children",[]);a.children.splice(0,0,n);var s=e.selectNodePath;return e.$nextTick((function(){s.push(0),e.$refs.slVueTree.select(s,!0)})),!1}))}else this.$Message.warning(this.$t(this.i18nStart+"levelRule",{maxLevel:this.maxLevel}))},saveBefore:function(){var e=this;this.$refs.frm.validate((function(t){t?e.save():e.$Message.error(e.$t("common.rules.validateFailure"))}))},actionDataProcess:function(e){var t=this,i=[],n=[];return e.forEach((function(e){var a=e.code,r=e.name,s=e.i18N,o=e.description,c=e.signature;if(c=!!c,!s){var d=t.getActionByCode(a);s=d.i18N}e.id?n.push({where:{id:e.id},data:{code:a,name:r,i18N:s,description:o,signature:c}}):e.code&&i.push({code:a,name:r,i18N:s,description:o,signature:c})})),{createActions:i,updateActions:n}},groupDataProcess:function(e){var t=this,i=[],n=[];return e.forEach((function(e){e.__typename&&delete e.__typename,e.$id&&delete e.$id;var a=e.id;if(a){var r=t.actionDataProcess(e.actions),s=r.createActions,o=r.updateActions,c=t.actionIdDeletes[a]?t.actionIdDeletes[a].map((function(e){return{id:e}})):[],d=e.code,l=e.name,u=e.i18N,h=e.description;n.push({where:{id:e.id},data:{code:d,name:l,i18N:u,description:h,actions:{delete:c,create:s,update:o}}})}else e.actions={create:e.actions.map((function(e){return{code:e.code,name:e.name,i18N:e.i18N,description:e.i18N}}))},i.push(e)})),{groupCreate:i,groupUpdate:n}},getVariablesData:function(){var e=this.selectNode,t=this.$_.cloneDeep(e),i=this.getParentNode(t),n=i.data.code,a=G({},t.data),r=a.actionGroups.concat([]),s=this.groupDataProcess(r),o=s.groupCreate,c=s.groupUpdate;e.data.module.code&&(a.module={connect:{code:e.data.module.code}});var d=this.selectNodeDataBackup.code,l={connect:{code:n}};delete a.actionGroups,delete a.$isNew;var u={where:{code:d}};return e.data.$isNew?(u.update={},u.create=G(G({},a),{},{parent:l,actionGroups:{create:o}})):(u.create=G(G({},a),{},{parent:l}),u.update=G(G({},a),{},{parent:l,actionGroups:{disconnect:this.groupIdDeletes,update:c,create:o}})),u},save:function(){var e=this;this.$apollo.mutate({mutation:O.a,variables:this.getVariablesData(),client:s["client"]}).then((function(t){e.afterSaveSuccess(e.selectNode.data,t)})).catch((function(){e.$Message.error(e.$t("common.saveFailure"))}))},afterSaveSuccess:function(e,t){this.$set(e,"$isNew",!1),delete e.$isNew;var i=t.data.upsertMenu.actionGroups;e.actionGroups=i,this.$set(e,"actionGroups",i),this.groupIdDeletes=[],this.actionIdDeletes={},this.$Message.success(this.$t("common.saveSuccess"))},refreshTree:function(){this.$apollo.queries.menus.refresh()},getNodeTitle:function(e){return this.existI18N(e.i18N)?this.$t(e.i18N):e.name},existI18N:function(e){var t=this.$t(e);return!0===this.$te(e)&&"object"!==Object(n["a"])(t)},convertMenuToNode:function(e){return{title:e.name,isLeaf:!e.menus||0===e.menus.length,isExpanded:!0,isSelected:!1,isDraggable:F,isSelectable:!0,data:{code:e.code,name:e.name,actionGroups:e.actionGroups.map((function(e){return e.$id=e.id,e})),menuType:e.menuType,url:e.url,i18N:e.i18N,icon:e.icon,module:e.module||{},orderNo:e.orderNo,description:e.description,enable:e.enable,$isNew:!0===e.$isNew}}},buildNestNodes:function(e){var t,i=[],n=C(e);try{for(n.s();!(t=n.n()).done;){var a=t.value,r=this.convertMenuToNode(a);r.data.$isNew=!1,i.push(r),a.menus&&a.menus.length>0&&(r.children=this.buildNestNodes(a.menus))}}catch(s){n.e(s)}finally{n.f()}return this.$_.sortBy(i,[function(e){return e.data.orderNo}])},getMaxLevel:function(e){if(!e)return 0;var t=e.level;if(e.children&&e.children.length>0){var i,n=C(e.children);try{for(n.s();!(i=n.n()).done;){var a=i.value;t=a.children&&a.children.length>0?Math.max(this.getMaxLevel(a),t):Math.max(a.level,t)}}catch(r){n.e(r)}finally{n.f()}}return t},getI18n:function(e){return this.$t(this.i18nStart+e)},getUrlPrepend:function(e){return e==o["a"].internal?"/src/views/":e===o["a"].internalLink?"/":"http(s)://"},updateActionStatus:function(e){var t=e.level<this.maxLevel&&!0!==e.data.$isNew,i=e.level>1&&(!e.children||e.children.length<1),n=e.level>1&&!e.isLastChild,a=e.level>1&&!e.isFirstChild,r=e.level>1&&e.ind>0&&this.getMaxLevel(e)<this.maxLevel,s=e.level>2&&(!e.children||0===e.children.length);this.actionsOptions.add.disabled=!t,this.actionsOptions.remove.disabled=!i,this.actionsOptions.upgrade.disabled=!s,this.actionsOptions.degrade.disabled=!r,this.actionsOptions.downward.disabled=!n,this.actionsOptions.upward.disabled=!a}},watch:{},mounted:function(){this._noticeName=S.a.generate(),this.$Notice.warning({name:this._noticeName,title:this.$t("common.tips"),duration:5,desc:this.$t(this.i18nStart+"tips",{maxLevel:this.maxLevel})})},beforeDestroy:function(){this.$Notice.close(this._noticeName)}}}}]);